{"ast":null,"code":"import { IDENTITY_CONFIG, METADATA_OIDC } from '../Const/AuthConst';\nimport { UserManager, WebStorageStateStore, Log } from 'oidc-client';\nimport { AppSettings } from \"../appSettings\";\nexport default class AuthService {\n  constructor() {\n    this.signinRedirectCallback = () => {\n      return this.UserManager.signinRedirectCallback();\n    };\n\n    this.getUser = async () => {\n      const user = await this.UserManager.getUser();\n\n      if (!user) {\n        return await this.UserManager.signinRedirectCallback();\n      }\n\n      return user;\n    };\n\n    this.parseJwt = token => {\n      const base64Url = token.split('.')[1];\n      const base64 = base64Url.replace('-', '+').replace('_', '/');\n      return JSON.parse(window.atob(base64));\n    };\n\n    this.signinRedirect = authstate => {\n      if (authstate) {\n        authstate = {\n          state: authstate\n        };\n      }\n\n      console.log('signinRedirect');\n      console.log(authstate);\n      this.UserManager.signinRedirect(authstate);\n    };\n\n    this.isAuthenticated = () => {\n      return this._user != null && !this._user.expired;\n    };\n\n    this.signinSilent = () => {\n      console.log('signinSilent...'); //this.UserManager.signinSilent()\n\n      this.UserManager.startSilentRenew();\n      /*    .then((user: any) => {\n              console.log('signed in', user);\n          })\n          .catch((err: any) => {\n              console.log(err);\n          });*/\n    };\n\n    this.signinSilentCallback = () => {\n      console.log('signed in call back');\n      this.UserManager.signinSilentCallback();\n    };\n\n    this.createSigninRequest = () => {\n      console.log('!!!!!!!!!!!!!createSigninRequest');\n      return this.UserManager.createSigninRequest();\n    };\n\n    this.logout = () => {\n      //revocation endpoint call\n      this.UserManager.revokeAccessToken();\n      this.UserManager.signoutRedirect({\n        id_token_hint: localStorage.getItem('id_token')\n      });\n      this.UserManager.clearStaleState();\n      this._user = null;\n    };\n\n    this.signoutRedirectCallback = () => {\n      this.UserManager.signoutRedirectCallback().then(user => {\n        localStorage.clear();\n        const appBaseUrl = `${AppSettings.BASE_APP_URL}/${AppSettings.BASE_APP_NAME}`;\n        window.location.replace(appBaseUrl);\n      });\n      this.UserManager.clearStaleState();\n    };\n\n    this.UserManager = new UserManager({ ...IDENTITY_CONFIG,\n      userStore: new WebStorageStateStore({\n        store: window.sessionStorage\n      }),\n      metadata: { ...METADATA_OIDC\n      }\n    });\n    this.UserManager.getUser().then(user => {\n      this._user = user;\n    }); // Logger\n\n    Log.logger = console;\n    Log.level = Log.DEBUG;\n    this.UserManager.events.addUserLoaded(user => {\n      // Once the user is loaded assign the value to local user\n      this._user = user;\n      console.log(this._user);\n    });\n    this.UserManager.events.addUserSignedOut(() => {\n      console.log('User Signed Out ');\n      this.logout();\n    });\n    this.UserManager.events.addSilentRenewError(e => {\n      console.log('silent renew error', e.message);\n    });\n    this.UserManager.events.addAccessTokenExpiring(e => {\n      console.log('Token Expiring.... ');\n      this.signinSilent();\n    });\n    this.UserManager.events.addAccessTokenExpired(() => {\n      console.log('token expired');\n      this.logout();\n    });\n  }\n\n}","map":{"version":3,"sources":["/Users/plsingh/Downloads/archive-19Sep-Sunday/src/utils/Services/AuthService.js"],"names":["IDENTITY_CONFIG","METADATA_OIDC","UserManager","WebStorageStateStore","Log","AppSettings","AuthService","constructor","signinRedirectCallback","getUser","user","parseJwt","token","base64Url","split","base64","replace","JSON","parse","window","atob","signinRedirect","authstate","state","console","log","isAuthenticated","_user","expired","signinSilent","startSilentRenew","signinSilentCallback","createSigninRequest","logout","revokeAccessToken","signoutRedirect","id_token_hint","localStorage","getItem","clearStaleState","signoutRedirectCallback","then","clear","appBaseUrl","BASE_APP_URL","BASE_APP_NAME","location","userStore","store","sessionStorage","metadata","logger","level","DEBUG","events","addUserLoaded","addUserSignedOut","addSilentRenewError","e","message","addAccessTokenExpiring","addAccessTokenExpired"],"mappings":"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","sourcesContent":["import { IDENTITY_CONFIG, METADATA_OIDC } from '../Const/AuthConst';\nimport { UserManager, WebStorageStateStore, Log } from 'oidc-client';\nimport { AppSettings } from \"../appSettings\";\n\nexport default class AuthService {\n    UserManager;\n    _user;\n    constructor() {\n        this.UserManager = new UserManager({\n            ...IDENTITY_CONFIG,\n            userStore: new WebStorageStateStore({ store: window.sessionStorage }),\n            metadata: {\n                ...METADATA_OIDC,\n            },\n        });\n        this.UserManager.getUser().then((user) => {\n            this._user = user;\n        });\n\n        // Logger\n        Log.logger = console;\n        Log.level = Log.DEBUG;\n\n        this.UserManager.events.addUserLoaded((user) => {\n            // Once the user is loaded assign the value to local user\n            this._user = user;\n            console.log(this._user);\n        });\n        this.UserManager.events.addUserSignedOut(() => {\n            console.log('User Signed Out ');\n            this.logout();\n        });\n\n        this.UserManager.events.addSilentRenewError((e) => {\n            console.log('silent renew error', e.message);\n        });\n\n        this.UserManager.events.addAccessTokenExpiring((e) => {\n            console.log('Token Expiring.... ');\n            this.signinSilent();\n        });\n\n        this.UserManager.events.addAccessTokenExpired(() => {\n            console.log('token expired');\n            this.logout();\n        });\n    }\n\n    signinRedirectCallback = () => {\n        return this.UserManager.signinRedirectCallback();\n    };\n\n    getUser = async () => {\n        const user = await this.UserManager.getUser();\n        if (!user) {\n            return await this.UserManager.signinRedirectCallback();\n        }\n        return user;\n    };\n\n    parseJwt = (token) => {\n        const base64Url = token.split('.')[1];\n        const base64 = base64Url.replace('-', '+').replace('_', '/');\n        return JSON.parse(window.atob(base64));\n    };\n\n    signinRedirect = (authstate) => {\n        if (authstate) {\n            authstate = { state: authstate };\n        }\n        console.log('signinRedirect');\n        console.log(authstate);\n        this.UserManager.signinRedirect(authstate);\n    };\n\n    isAuthenticated = () => {\n        return this._user != null && !this._user.expired;\n    };\n\n    signinSilent = () => {\n        console.log('signinSilent...');\n        //this.UserManager.signinSilent()\n        this.UserManager.startSilentRenew()\n        /*    .then((user: any) => {\n                console.log('signed in', user);\n            })\n            .catch((err: any) => {\n                console.log(err);\n            });*/\n    };\n\n    signinSilentCallback = () => {\n        console.log('signed in call back');\n        this.UserManager.signinSilentCallback();\n    };\n\n    createSigninRequest = () => {\n        console.log('!!!!!!!!!!!!!createSigninRequest');\n        return this.UserManager.createSigninRequest();\n    };\n\n    logout = () => {\n        //revocation endpoint call\n        this.UserManager.revokeAccessToken();\n        this.UserManager.signoutRedirect({\n            id_token_hint: localStorage.getItem('id_token'),\n        });\n        this.UserManager.clearStaleState();\n        this._user = null;\n    };\n\n    signoutRedirectCallback = () => {\n        this.UserManager.signoutRedirectCallback().then((user) => {\n            localStorage.clear();\n            const appBaseUrl = `${AppSettings.BASE_APP_URL}/${AppSettings.BASE_APP_NAME}`;\n            window.location.replace(appBaseUrl);\n        });\n        this.UserManager.clearStaleState();\n    };\n}\n"]},"metadata":{},"sourceType":"module"}